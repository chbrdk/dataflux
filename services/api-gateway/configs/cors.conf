# CORS configuration
# Cross-Origin Resource Sharing settings

# CORS headers for all API endpoints
map $http_origin $cors_origin {
    default "";
    "~^https?://localhost(:[0-9]+)?$" $http_origin;
    "~^https?://127\.0\.0\.1(:[0-9]+)?$" $http_origin;
    "~^https?://dataflux\.local(:[0-9]+)?$" $http_origin;
    "~^https?://.*\.dataflux\.local(:[0-9]+)?$" $http_origin;
}

# CORS headers
add_header Access-Control-Allow-Origin $cors_origin always;
add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS" always;
add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-API-Key" always;
add_header Access-Control-Expose-Headers "Content-Length,Content-Range,X-Total-Count" always;
add_header Access-Control-Allow-Credentials "true" always;

# Handle preflight requests
if ($request_method = 'OPTIONS') {
    add_header Access-Control-Allow-Origin $cors_origin;
    add_header Access-Control-Allow-Methods "GET, POST, PUT, DELETE, OPTIONS";
    add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-API-Key";
    add_header Access-Control-Max-Age 1728000;
    add_header Content-Type text/plain;
    add_header Content-Length 0;
    return 204;
}
